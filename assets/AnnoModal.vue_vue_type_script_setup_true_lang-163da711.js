var ee=Object.defineProperty,te=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var P=(s,e,n)=>e in s?ee(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,$=(s,e)=>{for(var n in e||(e={}))L.call(e,n)&&P(s,n,e[n]);if(K)for(var n of K(e))j.call(e,n)&&P(s,n,e[n]);return s},V=(s,e)=>te(s,ae(e));var N=(s,e)=>{var n={};for(var r in s)L.call(s,r)&&e.indexOf(r)<0&&(n[r]=s[r]);if(s!=null&&K)for(var r of K(s))e.indexOf(r)<0&&j.call(s,r)&&(n[r]=s[r]);return n};var x=(s,e,n)=>new Promise((r,a)=>{var f=d=>{try{h(n.next(d))}catch(v){a(v)}},g=d=>{try{h(n.throw(d))}catch(v){a(v)}},h=d=>d.done?r(d.value):Promise.resolve(d.value).then(f,g);h((n=n.apply(s,e)).next())});import{a as W,B as G,u as oe}from"./index-470a7b7c.js";import{a as ne,c as se,g as le,h as ie,u as re,_ as de}from"./componentMap-a91d4bed.js";import{aB as ce,aC as ue,aD as q,aE as Z,W as me,aq as pe,ar as fe,aF as ge,au as he}from"./index.js";import{d as B,f as b,J as S,Z as _,a5 as w,a6 as k,u as c,a9 as z,aa as H,w as F,y as J,a7 as ye,G as U,c as Q,_ as D,k as R,F as X,r as E,a8 as _e}from"./vue-ae6a2213.js";import{ad as ve,ae as Me,a9 as be,af as Te}from"./antd-8e9c6fb8.js";const Ce=B({__name:"AnnoM2mModal",emits:["success","register"],setup(s,{emit:e}){const n=e,r=b(null),a=b(null),f=b(!1),g=b(null),[h,{setModalProps:d,closeModal:v}]=W(p=>x(this,null,function*(){const{props:M,option:C,isAdd:o}=p;r.value=S(M),a.value=S(C),f.value=S(o),d({confirmLoading:!1,title:(o?"新增":"管理")+C.name,width:o?800:920,height:600,okText:o?"关联":"确认",showOkBtn:o,cancelText:"关闭"})}));function T(){f.value&&g.value.clearSelectedRowKeys()}function u(){return x(this,null,function*(){try{if(f.value){const p=g.value.getAddRows();g.value.clearSelectedRowKeys(),n("success",p)}d({confirmLoading:!0}),v()}finally{d({confirmLoading:!1})}})}return(p,M)=>(_(),w(c(G),H(p.$attrs,{onRegister:c(h),title:"测试",onOk:u,onCancel:T}),{default:k(()=>[c(a)?(_(),w(Y,{key:0,ref_key:"AnnoM2mRef",ref:g,data:c(r),"is-add":c(f),option:c(a)},null,8,["data","is-add","option"])):z("",!0)]),_:1},16,["onRegister"]))}}),we=B({__name:"AnnoM2mTable",props:{tableConfig:{},data:{},isAdd:{type:Boolean}},emits:["addM2m","deleteRows"],setup(s,{expose:e,emit:n}){const r=n,a=s,f=()=>{const u=v();r("deleteRows",u)},[g,{reload:h,setProps:d,getSelectRowKeys:v,clearSelectedRowKeys:T}]=ne(null);return F(()=>a.tableConfig.tableKey,()=>{a.tableConfig.tableKey&&J(()=>{d(a.tableConfig),d(S(a.tableConfig))})},{immediate:!0}),F(()=>a.tableConfig.searchInfo,()=>{J(()=>{h(),T()})}),e({reload:h,getSelectRowKeys:v,clearSelectedRowKeys:T,setProps:d}),(u,p)=>{const M=ye("a-button");return _(),w(c(se),{onRegister:c(g),style:{"box-sizing":"border-box"}},{toolbar:k(()=>[a.isAdd?z("",!0):(_(),w(M,{key:0,type:"error",onClick:f},{default:k(()=>[U("取消关联")]),_:1})),a.isAdd?z("",!0):(_(),w(M,{key:1,type:"primary",onClick:p[0]||(p[0]=C=>r("addM2m"))},{default:k(()=>[U("关联")]),_:1}))]),_:1},8,["onRegister"])}}}),ke={style:{height:"400px"}},Ae=B({__name:"AnnoM2mTree",props:{options:{},data:{}},setup(s){const e=s;F(()=>e.options,o=>{o&&J(()=>{r(o.m2mData.m2mJoinTargetClazz)})},{immediate:!0}),F(()=>e.data,o=>{o&&J(()=>{a(e.options.m2mData.m2mJoinTargetClazz)})},{immediate:!0});const n=b([]),r=o=>{ce(o,{}).then(i=>{n.value=i,d(JSON.parse(JSON.stringify(n.value))),a(e.options.m2mData.m2mJoinTargetClazz)})},a=o=>{ue(o,{annoM2mId:e.options.m2mData.id,joinValue:e.data[e.options.m2mData.m2mJoinThisClazzField]}).then(i=>{u.value=i})},f=(o,i,m)=>(i=="right"&&q(e.options.m2mData.m2mMediumTableClass,{annoM2mId:e.options.m2mData.id,targetJoinValue:m,thisJoinValue:e.data[e.options.m2mData.m2mJoinThisClazzField]}).catch(l=>{g("add",m)}),i=="left"&&Z(e.options.m2mData.m2mMediumTableClass,{annoM2mId:e.options.m2mData.id,targetJoinValue:m,thisJoinValue:e.data[e.options.m2mData.m2mJoinThisClazzField]}).catch(l=>{g("remove",m)}),!1);function g(o,i){o=="add"?u.value=u.value.filter(m=>!i.includes(m)):u.value=u.value.concat(i)}const h=[];function d(o=[]){o.forEach(i=>{h.push(i),d(i.children)})}function v(o,i){return o.indexOf(i)!==-1}function T(o,i=[]){return o.map(A=>{var t=A,{children:m}=t,l=N(t,["children"]);return V($({},l),{disabled:i.includes(l.key),children:T(m!=null?m:[],i)})})}const u=b([]),p=b(h),M=Q(()=>T(n.value,u.value)),C=(o,i,m)=>{const{eventKey:l}=o.node;m(l,!v(i,l))};return(o,i)=>(_(),D("div",ke,[R(c(Me),{"target-keys":u.value,"onUpdate:targetKeys":i[0]||(i[0]=m=>u.value=m),class:"tree-transfer","data-source":p.value,"list-style":{height:"400px",width:"300px"},render:m=>m.title,"show-select-all":!0,onChange:f},{children:k(({direction:m,selectedKeys:l,onItemSelect:A})=>[m==="left"?(_(),D(X,{key:0},[M.value.length>0?(_(),w(c(ve),{key:0,"block-node":"",checkable:"","check-strictly":"","default-expand-all":"","checked-keys":[...l,...u.value],"tree-data":M.value,onCheck:(t,y)=>{C(y,[...l,...u.value],A)},onSelect:(t,y)=>{C(y,[...l,...u.value],A)}},null,8,["checked-keys","tree-data","onCheck","onSelect"])):z("",!0)],64)):z("",!0)]),_:1},8,["target-keys","data-source","render"])]))}});const De=me(Ae,[["__scopeId","data-v-3aaa3e70"]]),Re={key:0,class:"w-full justify-center flex"},Se={key:1,class:"w-full justify-center flex"},Y=B({__name:"AnnoM2m",props:{option:{},data:{},isAdd:{type:[Boolean,null]}},emits:["addM2m"],setup(s,{expose:e,emit:n}){const{createMessage:r}=he(),a=s;F(()=>a.option,t=>{t&&v(t.m2mData.m2mJoinTargetClazz)},{immediate:!0});const f=E({}),[g,{openModal:h}]=oe(),d=()=>{h(!0,{props:S(a.data),option:S(a.option),isAdd:!0})};function v(t){pe(t).then(y=>{Object.assign(f,y),J(()=>{M(y.treeDisplayAsTree?"tree":"table",y,a.data)})})}const T=Q(()=>({annoM2mId:a.option.m2mData.id,joinValue:a.data[a.option.m2mData.m2mJoinThisClazzField],reverseM2m:a.isAdd})),u=E({}),p=b(null);function M(t,y,I){if(t=="table")C(y);else if(t=="tree")o();else return t}const C=t=>{const y=fe(t.entityName,t.treeParentKey,t.treeKey,t.treeDisplayAsTree),I=le(t.fields);Object.assign(u,{tableKey:a.option.m2mData.m2mJoinTargetClazz,pagination:{pageSize:t.treeDisplayAsTree?99999:20},api:y,size:"small",rowSelection:{},scroll:{x:!0,y:250},isTreeTable:t.treeDisplayAsTree,rowKey:t.pkField.fieldName,columns:ie(t.fields),formConfig:{rowProps:{gutter:16,justify:"start"},labelWidth:100,showAdvancedButton:!1,labelAlign:"left",autoAdvancedLine:50,schemas:I,autoSubmitOnEnter:!0},useSearchForm:I.length>0,showTableSetting:!0,bordered:!0,searchInfo:T,handleSearchInfoFn(O){return O}})},o=()=>{},i=t=>{t.length<1||Z(a.option.m2mData.m2mMediumTableClass,{annoM2mId:a.option.m2mData.id,targetJoinValue:t,thisJoinValue:a.data[a.option.m2mData.m2mJoinThisClazzField]}).then(y=>{p.value.reload(),r.success("取消关联成功")})},m=t=>{t.length<1||q(a.option.m2mData.m2mMediumTableClass,{annoM2mId:a.option.m2mData.id,targetJoinValue:t,thisJoinValue:a.data[a.option.m2mData.m2mJoinThisClazzField]}).then(y=>{p.value.reload(),r.success("关联成功")})};return e({getAddRows:()=>{const t=p.value.getSelectRowKeys();if(!(t.length<1))return t},clearSelectedRowKeys:()=>{p.value.clearSelectedRowKeys()}}),(t,y)=>(_(),D("div",null,[c(f).treeDisplayAsTree===!0?(_(),D("div",Re,[R(De,{options:t.option,data:t.data},null,8,["options","data"])])):c(f).treeDisplayAsTree===!1?(_(),D("div",Se,[R(we,{tableConfig:c(u),ref_key:"M2mTable",ref:p,isAdd:t.isAdd,onAddM2m:d,onDeleteRows:i},null,8,["tableConfig","isAdd"])])):(_(),w(c(ge),{key:2,loading:!0,tip:"加载中"})),R(Ce,{onRegister:c(g),onSuccess:m},null,8,["onRegister"])]))}}),ze={key:0,class:"card-container"},Ie=B({name:"AnnModal",__name:"AnnoModal",props:{addSchema:{},editSchema:{},columnM2mButton:{}},emits:["success","register"],setup(s,{emit:e}){const n=e,r=s,a=b(!0),f=b(""),g=b(0),h=b();let d=null;const[v,{setFieldsValue:T,resetSchema:u,resetFields:p,validate:M}]=re({labelWidth:100,baseColProps:{span:24},schemas:[],rowProps:{gutter:16,justify:"start"},labelAlign:"left",showActionButtonGroup:!1,showResetButton:!1,showSubmitButton:!1,actionColOptions:{span:23}}),[C,{setModalProps:o,closeModal:i}]=W(l=>x(this,null,function*(){p(),a.value=!!(l!=null&&l.isUpdate),o({confirmLoading:!1,title:l!=null&&l.isUpdate?"编辑":"新增",width:960}),c(a)?(d!="edit"&&(yield u(r.editSchema)),f.value=l.record.id,J(()=>{T($({},l.record)),h.value=l.record}),d="edit"):(d!="add"&&(yield u(r.addSchema)),d="add")}));function m(){return x(this,null,function*(){try{const l=yield M();o({confirmLoading:!0}),n("success",{isUpdate:c(a),values:V($({},l),{id:f.value}),closeModal:i})}finally{o({confirmLoading:!1})}})}return(l,A)=>(_(),w(c(G),H(l.$attrs,{onRegister:c(C),onOk:m}),{default:k(()=>[R(c(de),{onRegister:c(v)},null,8,["onRegister"]),a.value&&l.columnM2mButton.length>0?(_(),D("div",ze,[R(c(be),{activeKey:g.value,"onUpdate:activeKey":A[0]||(A[0]=t=>g.value=t),type:"card"},{default:k(()=>[(_(!0),D(X,null,_e(l.columnM2mButton,(t,y)=>(_(),w(c(Te),{style:{"max-width":"100%"},key:y,tab:t.name},{default:k(()=>[R(Y,{data:h.value,"is-add":!1,option:t},null,8,["data","option"])]),_:2},1032,["tab"]))),128))]),_:1},8,["activeKey"])])):z("",!0)]),_:1},16,["onRegister"]))}});export{Ie as _,Ce as a};
