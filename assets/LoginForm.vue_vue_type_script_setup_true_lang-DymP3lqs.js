var h=(x,f,u)=>new Promise((r,g)=>{var o=l=>{try{c(u.next(l))}catch(d){g(d)}},y=l=>{try{c(u.throw(l))}catch(d){g(d)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(o,y);c((u=u.apply(x,f)).next())});import{d as $,f as p,r as A,c as N,u as e,Z as P,_ as U,m as F,A as R,k as s,a6 as a,G as w,a0 as _,an as V,F as G}from"./vue-C-fXn5x4.js";import{u as O,a as q,b as W,L as I,_ as Z}from"./LoginFormTitle.vue_vue_type_script_setup_true_lang-DpOknsRS.js";import{u as j,f as H,am as J,ay as Q}from"./index.js";import{ao as L,E,ap as X,B as D,ab as Y,ac as ee}from"./antd-Dxxf6MN8.js";const le=$({__name:"LoginForm",setup(x){const f=Y,u=ee,r=L.Item,g=E.Password,{t:o}=j(),{notification:y,createErrorModal:c}=Q(),{prefixCls:l}=H("login"),d=J(),{setLoginState:z,getLoginState:B}=O(),K=p(),S=p(),v=p(!1),k=p(!1),i=A({account:"",password:"",codeKey:"",imageCode:""}),{getFormRules:M}=q(i),{validForm:T}=W(S),C=N(()=>e(B)===I.LOGIN);function b(){return h(this,null,function*(){var t;const m=yield T();if(m)try{v.value=!0;const n=yield d.login({password:m.password,username:m.account,code:m.imageCode,codeKey:i.codeKey,mode:"none"});n&&y.success({message:o("sys.login.loginSuccessTitle"),description:`${o("sys.login.loginSuccessDesc")}: ${n.name}`,duration:3})}catch(n){c({title:o("sys.api.errorTip"),content:n.message||o("sys.api.networkExceptionMsg"),getContainer:()=>document.body.querySelector(`.${l}`)||document.body})}finally{v.value=!1,(t=K.value)==null||t.loadImagecode()}})}return(m,t)=>(P(),U(G,null,[F(s(Z,{class:"enter-x"},null,512),[[R,C.value]]),F(s(e(L),{class:"p-4 enter-x",model:i,rules:e(M),ref_key:"formRef",ref:S,onKeypress:V(b,["enter"])},{default:a(()=>[s(e(r),{name:"account",class:"enter-x"},{default:a(()=>[s(e(E),{size:"large",value:i.account,"onUpdate:value":t[0]||(t[0]=n=>i.account=n),placeholder:e(o)("sys.login.userName"),class:"fix-auto-fill"},null,8,["value","placeholder"])]),_:1}),s(e(r),{name:"password",class:"enter-x"},{default:a(()=>[s(e(g),{size:"large",visibilityToggle:"",value:i.password,"onUpdate:value":t[1]||(t[1]=n=>i.password=n),placeholder:e(o)("sys.login.password")},null,8,["value","placeholder"])]),_:1}),s(e(u),{class:"enter-x"},{default:a(()=>[s(e(f),{span:12},{default:a(()=>[s(e(r),null,{default:a(()=>[s(e(X),{checked:k.value,"onUpdate:checked":t[2]||(t[2]=n=>k.value=n),size:"small"},{default:a(()=>[w(_(e(o)("sys.login.rememberMe")),1)]),_:1},8,["checked"])]),_:1})]),_:1}),s(e(f),{span:12},{default:a(()=>[s(e(r),{style:{"text-align":"right"}},{default:a(()=>[s(e(D),{type:"link",size:"small",onClick:t[3]||(t[3]=n=>e(z)(e(I).RESET_PASSWORD))},{default:a(()=>[w(_(e(o)("sys.login.forgetPassword")),1)]),_:1})]),_:1})]),_:1})]),_:1}),s(e(r),{class:"enter-x"},{default:a(()=>[s(e(D),{type:"primary",size:"large",block:"",onClick:b,loading:v.value},{default:a(()=>[w(_(e(o)("sys.login.loginButton")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"]),[[R,C.value]])],64))}});export{le as _};
