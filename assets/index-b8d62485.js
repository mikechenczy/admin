var k=(w,i,t)=>new Promise((n,a)=>{var u=o=>{try{r(t.next(o))}catch(c){a(c)}},p=o=>{try{r(t.throw(o))}catch(c){a(c)}},r=o=>o.done?n(o.value):Promise.resolve(o.value).then(u,p);r((t=t.apply(w,i)).next())});import{am as I,bm as E,au as L,p as S,y as C,f as A,u as N,bn as F}from"./index.js";import{c as b,u as T}from"./index-e7870a53.js";import{a as q,B as z,u as x}from"./index-470a7b7c.js";import{h as G}from"./header-3a7411b4.js";import{_ as H}from"./componentMap-78462e6d.js";import{d as U,f as W,Z as P,a5 as y,a6 as d,aa as Z,u as e,a7 as j,k as l,G as M,c as J,_ as K,F as Q,a9 as R,$ as h,a1 as g,a0 as X}from"./vue-ae6a2213.js";import{D as Y,x as ee}from"./antd-8e9c6fb8.js";import"./index-e2325f80.js";import"./useContentViewHeight-ca8eb444.js";import"./useWindowSizeFn-be729167.js";import"./useSortable-1cd8f8b5.js";import"./lock-b1b3ff91.js";import"./useFormItem-e445be9f.js";import"./RadioButtonGroup.vue_vue_type_script_setup_true_lang-e84e3d3d.js";import"./index-949a3570.js";import"./onMountedOrActivated-d6e0a436.js";import"./index-81505b2a.js";import"./copyTextToClipboard-6d09c6e8.js";import"./index-58c143a0.js";import"./index-ca06cd68.js";import"./sortable.esm-9a942543.js";const oe=U({__name:"AnnoResetPwdModal",setup(w){const{createMessage:i}=L(),t=I(),n=W(null),a=[{field:"oldPwd",component:"InputPassword",label:"原密码",colProps:{span:24},componentProps:{placeholder:"请输入原密码"},rules:[{required:!0}]},{field:"newPwd1",component:"InputPassword",label:"新密码",colProps:{span:24},componentProps:{placeholder:"请输入新密码"},rules:[{required:!0}]},{field:"newPwd2",component:"InputPassword",label:"新密码",colProps:{span:24},componentProps:{placeholder:"请再次输入新密码"},rules:[{required:!0}]}],[u,{setModalProps:p,closeModal:r}]=q(m=>k(this,null,function*(){p({confirmLoading:!1,cancelText:"关闭"})}));function o(){n.value.resetFields(),r()}function c(){n.value.validate().then(m=>k(this,null,function*(){var s=n.value.getFieldsValue();if(s.newPwd1!==s.newPwd2){i.error("两次输入的新密码不一致");return}if(s.oldPwd===s.newPwd1){i.error("新密码不能与旧密码一致");return}E({oldPwd:s.oldPwd,newPwd1:s.newPwd1,newPwd2:s.newPwd2}).then(f=>{i.success("重置密码成功"),r(),t.logout(!0)}),yield n.value.resetFields()}))}return(m,s)=>{const f=j("a-button");return P(),y(e(z),Z(m.$attrs,{onRegister:e(u),title:"重置用户密码",onOk:c,onCancel:o}),{footer:d(()=>[l(f,{key:"back",onClick:o},{default:d(()=>[M(" 取消 ")]),_:1}),l(f,{key:"submit",type:"primary",onClick:c},{default:d(()=>[M(" 重置密码 ")]),_:1})]),default:d(()=>[l(e(H),{labelWidth:100,schemas:a,ref_key:"formElRef",ref:n,showResetButton:!1,showSubmitButton:!1,actionColOptions:{span:24}},null,512)]),_:1},16,["onRegister"])}}}),te=["src"],xe=U({name:"UserDropdown",__name:"index",props:{theme:S.oneOf(["dark","light"])},setup(w){const{createMessage:i}=L(),t=b(()=>C(()=>import("./DropMenuItem-48ccae4a.js"),["assets/DropMenuItem-48ccae4a.js","assets/index.js","assets/vue-ae6a2213.js","assets/antd-8e9c6fb8.js","assets/index-843e180f.css"])),n=b(()=>C(()=>import("./LockModal-6ca7cf91.js"),["assets/LockModal-6ca7cf91.js","assets/index.js","assets/vue-ae6a2213.js","assets/antd-8e9c6fb8.js","assets/index-843e180f.css","assets/index-470a7b7c.js","assets/useWindowSizeFn-be729167.js","assets/index-231a7ee0.css","assets/componentMap-78462e6d.js","assets/useFormItem-e445be9f.js","assets/RadioButtonGroup.vue_vue_type_script_setup_true_lang-e84e3d3d.js","assets/useSortable-1cd8f8b5.js","assets/index-949a3570.js","assets/onMountedOrActivated-d6e0a436.js","assets/index-81505b2a.js","assets/index-74456602.css","assets/copyTextToClipboard-6d09c6e8.js","assets/index-58c143a0.js","assets/index-7f5b8959.css","assets/index-ca06cd68.js","assets/index-381445b0.css","assets/sortable.esm-9a942543.js","assets/componentMap-71df5c25.css","assets/lock-b1b3ff91.js","assets/header-3a7411b4.js","assets/LockModal-ca58db68.css"])),{prefixCls:a}=A("header-user-dropdown"),{t:u}=N(),{getUseLockPage:p}=T(),r=I(),o=J(()=>{const{name:_="",avatar:v}=r.getUserInfo||{};return{name:_,avatar:v||G}}),[c,{openModal:m}]=x(),[s,{openModal:f}]=x();function $(){m(!0)}function B(){r.confirmLoginOut()}function O(){F().then(_=>{i.success("缓存清除成功")})}function V(){f(!0)}function D(_){switch(_.key){case"logout":B();break;case"lock":$();break;case"clearUserCache":O();break;case"changeUserPassword":V();break}}return(_,v)=>(P(),K(Q,null,[l(e(Y),{placement:"bottomLeft",overlayClassName:`${e(a)}-dropdown-overlay`},{overlay:d(()=>[l(e(ee),{onClick:D},{default:d(()=>[e(p)?(P(),y(e(t),{key:"clearUserCache",text:"清除缓存",icon:"ant-design:clear-outlined"})):R("",!0),l(e(t),{key:"changeUserPassword",text:"修改密码",icon:"ant-design:security-scan-outlined"}),e(p)?(P(),y(e(t),{key:"lock",text:e(u)("layout.header.tooltipLock"),icon:"ion:lock-closed-outline"},null,8,["text"])):R("",!0),l(e(t),{key:"logout",text:e(u)("layout.header.dropdownItemLoginOut"),icon:"ion:power-outline"},null,8,["text"])]),_:1})]),default:d(()=>[h("span",{class:g([[e(a),`${e(a)}--${w.theme}`],"flex"])},[h("img",{class:g(`${e(a)}__header`),src:o.value.avatar},null,10,te),h("span",{class:g(`${e(a)}__info hidden md:block`)},[h("span",{class:g([`${e(a)}__name`,"truncate"])},X(o.value.name),3)],2)],2)]),_:1},8,["overlayClassName"]),l(e(n),{onRegister:e(c)},null,8,["onRegister"]),l(oe,{onRegister:e(s)},null,8,["onRegister"])],64))}});export{xe as default};
