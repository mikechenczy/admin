var te=Object.defineProperty,oe=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var D=(s,t,a)=>t in s?te(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,V=(s,t)=>{for(var a in t||(t={}))L.call(t,a)&&D(s,a,t[a]);if($)for(var a of $(t))P.call(t,a)&&D(s,a,t[a]);return s},N=(s,t)=>oe(s,ne(t));var U=(s,t)=>{var a={};for(var r in s)L.call(s,r)&&t.indexOf(r)<0&&(a[r]=s[r]);if(s!=null&&$)for(var r of $(s))t.indexOf(r)<0&&P.call(s,r)&&(a[r]=s[r]);return a};var x=(s,t,a)=>new Promise((r,l)=>{var n=c=>{try{v(a.next(c))}catch(f){l(f)}},y=c=>{try{v(a.throw(c))}catch(f){l(f)}},v=c=>c.done?r(c.value):Promise.resolve(c.value).then(n,y);v((a=a.apply(s,t)).next())});import{a as W,B as q,u as ae}from"./index-Ct8wWWt8.js";import{a as se,c as ie,g as le,h as re,u as ue,_ as de}from"./useForm-RgYvicpQ.js";import{D as O,aC as ce,aD as me,aE as Q,aF as Z,_ as pe,aq as fe,ar as ge,aG as he,ay as ye}from"./index.js";import{d as I,f as M,Z as T,a5 as k,a6 as B,u,a9 as S,aa as H,J,w as K,y as j,a7 as ve,G as E,c as X,_ as z,k as R,F as Y,r as G,a8 as be}from"./vue-C-fXn5x4.js";import{ae as Te,af as _e,Q as Me,R as Ce}from"./antd-Dxxf6MN8.js";const we=I({__name:"AnnoM2mModal",emits:["success","register"],setup(s,{emit:t}){const a=t,r=M(null),l=M(null),n=M(!1),y=M(null),{getIsMobile:v}=O(),[c,{setModalProps:f,closeModal:C}]=W(g=>x(this,null,function*(){const{props:w,option:i,isAdd:o}=g;r.value=J(w),l.value=J(i),n.value=J(o),f({confirmLoading:!1,title:(o?"新增":"管理")+i.name,width:o?800:920,height:600,okText:o?"关联":"确认",showOkBtn:o,defaultFullscreen:v.value,cancelText:"关闭"})}));function m(){n.value&&y.value.clearSelectedRowKeys()}function b(){return x(this,null,function*(){try{if(n.value){const g=y.value.getAddRows();y.value.clearSelectedRowKeys(),a("success",g)}f({confirmLoading:!0}),C()}finally{f({confirmLoading:!1})}})}return(g,w)=>(T(),k(u(q),H(g.$attrs,{onRegister:u(c),title:"测试",onOk:b,onCancel:m}),{default:B(()=>[u(l)?(T(),k(ee,{key:0,ref_key:"AnnoM2mRef",ref:y,data:u(r),"is-add":u(n),option:u(l)},null,8,["data","is-add","option"])):S("",!0)]),_:1},16,["onRegister"]))}}),ke=I({__name:"AnnoM2mTable",props:{tableConfig:{},data:{},isAdd:{type:Boolean}},emits:["addM2m","deleteRows"],setup(s,{expose:t,emit:a}){const r=a,l=s,n=()=>{const m=f();r("deleteRows",m)},[y,{reload:v,setProps:c,getSelectRowKeys:f,clearSelectedRowKeys:C}]=se(null);return K(()=>l.tableConfig.tableKey,()=>{l.tableConfig.tableKey&&j(()=>{c(l.tableConfig),c(J(l.tableConfig))})},{immediate:!0}),K(()=>l.tableConfig.searchInfo,()=>{j(()=>{v(),C()})}),t({reload:v,getSelectRowKeys:f,clearSelectedRowKeys:C,setProps:c}),(m,b)=>{const g=ve("a-button");return T(),k(u(ie),{onRegister:u(y),style:{"box-sizing":"border-box"}},{toolbar:B(()=>[l.isAdd?S("",!0):(T(),k(g,{key:0,type:"error",onClick:n},{default:B(()=>b[1]||(b[1]=[E("取消关联")])),_:1})),l.isAdd?S("",!0):(T(),k(g,{key:1,type:"primary",onClick:b[0]||(b[0]=w=>r("addM2m"))},{default:B(()=>b[2]||(b[2]=[E("关联")])),_:1}))]),_:1},8,["onRegister"])}}}),Ae={style:{height:"400px"}},Be=I({__name:"AnnoM2mTree",props:{options:{},data:{}},setup(s){const t=s;K(()=>t.options,i=>{i&&j(()=>{r(i.m2mJoinButton.joinTargetClazz)})},{immediate:!0}),K(()=>t.data,i=>{i&&j(()=>{l(t.options.m2mJoinButton.joinTargetClazz)})},{immediate:!0});const a=M([]),r=i=>{ce(i,{}).then(o=>{a.value=o,c(JSON.parse(JSON.stringify(a.value))),l(t.options.m2mJoinButton.joinTargetClazz)})},l=i=>{me(i,{annoM2mId:t.options.m2mJoinButton.id,joinValue:t.data[t.options.m2mJoinButton.joinThisClazzField]}).then(o=>{m.value=o})},n=(i,o,d)=>(o=="right"&&Q(t.options.m2mJoinButton.mediumTableClazz,{annoM2mId:t.options.m2mJoinButton.id,targetJoinValue:d,thisJoinValue:t.data[t.options.m2mJoinButton.joinThisClazzField]}).catch(_=>{y("add",d)}),o=="left"&&Z(t.options.m2mJoinButton.mediumTableClazz,{annoM2mId:t.options.m2mJoinButton.id,targetJoinValue:d,thisJoinValue:t.data[t.options.m2mJoinButton.joinThisClazzField]}).catch(_=>{y("remove",d)}),!1);function y(i,o){i=="add"?m.value=m.value.filter(d=>!o.includes(d)):m.value=m.value.concat(o)}const v=[];function c(i=[]){i.forEach(o=>{v.push(o),c(o.children)})}function f(i,o){return i.indexOf(o)!==-1}function C(i,o=[]){return i.map(p=>{var e=p,{children:d}=e,_=U(e,["children"]);return N(V({},_),{disabled:o.includes(_.key),children:C(d!=null?d:[],o)})})}const m=M([]),b=M(v),g=X(()=>C(a.value,m.value)),w=(i,o,d)=>{const{eventKey:_}=i.node;d(_,!f(o,_))};return(i,o)=>(T(),z("div",Ae,[R(u(_e),{"target-keys":m.value,"onUpdate:targetKeys":o[0]||(o[0]=d=>m.value=d),class:"tree-transfer","data-source":b.value,"list-style":{height:"400px",width:"300px"},render:d=>d.title,"show-select-all":!0,onChange:n},{children:B(({direction:d,selectedKeys:_,onItemSelect:p})=>[d==="left"?(T(),z(Y,{key:0},[g.value.length>0?(T(),k(u(Te),{key:0,"block-node":"",checkable:"","check-strictly":"","default-expand-all":"","checked-keys":[..._,...m.value],"tree-data":g.value,onCheck:(e,h)=>{w(h,[..._,...m.value],p)},onSelect:(e,h)=>{w(h,[..._,...m.value],p)}},null,8,["checked-keys","tree-data","onCheck","onSelect"])):S("",!0)],64)):S("",!0)]),_:1},8,["target-keys","data-source","render"])]))}}),ze=pe(Be,[["__scopeId","data-v-87363336"]]),Re={key:0,class:"w-full justify-center flex"},Je={key:1,class:"w-full justify-center flex"},ee=I({__name:"AnnoM2m",props:{option:{},data:{},isAdd:{type:[Boolean,null]}},emits:["addM2m"],setup(s,{expose:t,emit:a}){const{getIsMobile:r}=O(),{createMessage:l}=ye(),n=s;K(()=>n.option,e=>{e&&C(e.m2mJoinButton.joinTargetClazz)},{immediate:!0});const y=G({}),[v,{openModal:c}]=ae(),f=()=>{c(!0,{props:J(n.data),option:J(n.option),isAdd:!0})};function C(e){fe(e).then(h=>{Object.assign(y,h),j(()=>{w(h.annoTree.displayAsTree?"tree":"table",h,n.data)})})}const m=X(()=>({annoM2mId:n.option.m2mJoinButton.id,joinValue:n.data[n.option.m2mJoinButton.joinThisClazzField],reverseM2m:n.isAdd})),b=G({}),g=M(null);function w(e,h,A){if(e=="table")i(h);else if(e!="tree")return e}const i=e=>{const h=ge(e.entityName,e.annoTree.parentKey,e.annoTree.key,e.annoTree.displayAsTree),A=le(e.columns,r);Object.assign(b,{tableKey:n.option.m2mJoinButton.joinTargetClazz,pagination:{pageSize:e.annoTree.displayAsTree?99999:20},api:h,size:"small",rowSelection:{},scroll:{x:!0,y:250},isTreeTable:e.annoTree.displayAsTree,rowKey:e.pkColumn.javaName,columns:re(e.columns),formConfig:{rowProps:{gutter:16,justify:"start"},labelWidth:100,showAdvancedButton:!1,labelAlign:"left",autoAdvancedLine:50,schemas:A,autoSubmitOnEnter:!0},useSearchForm:A.length>0,showTableSetting:!0,bordered:!0,searchInfo:m,handleSearchInfoFn(F){return F}})},o=e=>{e.length<1||Z(n.option.m2mJoinButton.mediumTableClazz,{annoM2mId:n.option.m2mJoinButton.id,targetJoinValue:e,thisJoinValue:n.data[n.option.m2mJoinButton.joinThisClazzField]}).then(h=>{g.value.reload(),l.success("取消关联成功")})},d=e=>{e.length<1||Q(n.option.m2mJoinButton.mediumTableClazz,{annoM2mId:n.option.m2mJoinButton.id,targetJoinValue:e,thisJoinValue:n.data[n.option.m2mJoinButton.joinThisClazzField]}).then(h=>{g.value.reload(),l.success("关联成功")})};return t({getAddRows:()=>{const e=g.value.getSelectRowKeys();if(!(e.length<1))return e},clearSelectedRowKeys:()=>{g.value.clearSelectedRowKeys()}}),(e,h)=>{var A,F;return T(),z("div",null,[((A=u(y).annoTree)==null?void 0:A.displayAsTree)===!0?(T(),z("div",Re,[R(ze,{options:e.option,data:e.data},null,8,["options","data"])])):((F=u(y).annoTree)==null?void 0:F.displayAsTree)===!1?(T(),z("div",Je,[R(ke,{tableConfig:u(b),ref_key:"M2mTable",ref:g,isAdd:e.isAdd,onAddM2m:f,onDeleteRows:o},null,8,["tableConfig","isAdd"])])):(T(),k(u(he),{key:2,loading:!0,tip:"加载中"})),R(we,{onRegister:u(v),onSuccess:d},null,8,["onRegister"])])}}}),Se={key:0,class:"card-container"},Ve=I({name:"AnnModal",__name:"AnnoModal",props:{addSchema:{},editSchema:{},columnM2mButton:{},rowKey:{}},emits:["success","register"],setup(s,{emit:t}){const a=t,{getIsMobile:r}=O(),l=s,n=M(!0),y=M(""),v=M(0),c=M();let f=null;const[C,{setFieldsValue:m,resetSchema:b,resetFields:g,validate:w}]=ue({labelWidth:100,baseColProps:{span:24},schemas:[],rowProps:{gutter:16,justify:"start"},labelAlign:"left",showActionButtonGroup:!1,showResetButton:!1,showSubmitButton:!1,actionColOptions:{span:23}}),[i,{setModalProps:o,closeModal:d}]=W(p=>x(this,null,function*(){g(),n.value=!!(p!=null&&p.isUpdate),o({confirmLoading:!1,title:p!=null&&p.isUpdate?"编辑":"新增",width:960,defaultFullscreen:r.value}),u(n)?(f!="edit"&&(yield b(l.editSchema)),y.value=p.record[l.rowKey],j(()=>{m(V({},p.record)),c.value=p.record}),f="edit"):(f!="add"&&(yield b(l.addSchema)),f="add")}));function _(){return x(this,null,function*(){try{const p=yield w();o({confirmLoading:!0});let e=V({},p);e[l.rowKey]=y.value,a("success",{isUpdate:u(n),values:e,closeModal:d})}finally{o({confirmLoading:!1})}})}return(p,e)=>(T(),k(u(q),H(p.$attrs,{onRegister:u(i),onOk:_}),{default:B(()=>[R(u(de),{onRegister:u(C)},null,8,["onRegister"]),n.value&&p.columnM2mButton.length>0?(T(),z("div",Se,[R(u(Ce),{activeKey:v.value,"onUpdate:activeKey":e[0]||(e[0]=h=>v.value=h),type:"card"},{default:B(()=>[(T(!0),z(Y,null,be(p.columnM2mButton,(h,A)=>(T(),k(u(Me),{style:{"max-width":"100%"},key:A,tab:h.name},{default:B(()=>[R(ee,{data:c.value,"is-add":!1,option:h},null,8,["data","option"])]),_:2},1032,["tab"]))),128))]),_:1},8,["activeKey"])])):S("",!0)]),_:1},16,["onRegister"]))}});export{Ve as _,we as a};
