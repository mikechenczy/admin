var he=Object.defineProperty,ye=Object.defineProperties;var be=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable;var ne=(o,r,l)=>r in o?he(o,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):o[r]=l,k=(o,r)=>{for(var l in r||(r={}))ve.call(r,l)&&ne(o,l,r[l]);if(te)for(var l of te(r))Me.call(r,l)&&ne(o,l,r[l]);return o},L=(o,r)=>ye(o,be(r));var z=(o,r,l)=>new Promise((c,i)=>{var a=d=>{try{t(l.next(d))}catch(u){i(u)}},e=d=>{try{t(l.throw(d))}catch(u){i(u)}},t=d=>d.done?c(d.value):Promise.resolve(d.value).then(a,e);t((l=l.apply(o,r)).next())});import{u as ie,o as Ce,aO as He,a6 as Se,v as ke,t as Be,bc as Fe,S as Oe,f as ce,a5 as we,d as Te,a8 as Pe,a9 as ue,a7 as $e,aa as Ne}from"./index.js";import{h as Y,u as n,d as W,I as De,k as B,i as Re,f as g,c as F,w as de,o as _e,b as pe,y as $,n as We,Z as M,a5 as D,a6 as h,m as xe,_ as X,ac as N,ae as Ee,F as je,a9 as G,a1 as Le,a7 as Ie,G as J,a0 as K,aa as I,K as Ae,z as ze,ab as oe,a8 as ae,ah as le,ai as se,g as Q,r as fe,J as q}from"./vue-C-fXn5x4.js";import{M as qe,a4 as Ve,T as U,a3 as Xe,aM as Ye,o as V,e as me,a as Ue}from"./antd-Dxxf6MN8.js";import{u as Ge}from"./useWindowSizeFn-B-ZcP_zC.js";const{t:re}=ie(),Je={open:{type:Boolean},scrollTop:{type:Boolean,default:!0},height:{type:Number},minHeight:{type:Number},draggable:{type:Boolean,default:!0},centered:{type:Boolean},cancelText:{type:String,default:re("common.cancelText")},okText:{type:String,default:re("common.okText")},closeFunc:Function},ee=Object.assign({},Je,{defaultFullscreen:{type:Boolean},canFullscreen:{type:Boolean,default:!0},wrapperFooterOffset:{type:Number,default:0},helpMessage:[String,Array],useWrapper:{type:Boolean,default:!0},loading:{type:Boolean},loadingTip:{type:String},showCancelBtn:{type:Boolean,default:!0},showOkBtn:{type:Boolean,default:!0},wrapperProps:Object,afterClose:Function,bodyStyle:Object,closable:{type:Boolean,default:!0},closeIcon:Object,confirmLoading:{type:Boolean},destroyOnClose:{type:Boolean},footer:Object,getContainer:Function,mask:{type:Boolean,default:!0},maskClosable:{type:Boolean,default:!0},keyboard:{type:Boolean,default:!0},maskStyle:Object,okType:{type:String,default:"primary"},okButtonProps:Object,cancelButtonProps:Object,title:{type:String},open:{type:Boolean},width:[String,Number],wrapClassName:{type:String},zIndex:{type:Number}});function Ke(o){const r=(i,a)=>getComputedStyle(i)[a],l=i=>{if(!i)return;i.setAttribute("data-drag",n(o.draggable));const a=i.querySelector(".ant-modal-header"),e=i.querySelector(".ant-modal");!a||!e||!n(o.draggable)||(a.style.cursor="move",a.onmousedown=t=>{if(!t)return;const d=t.clientX,u=t.clientY,C=document.body.clientWidth,v=document.documentElement.clientHeight,y=e.offsetWidth,p=e.offsetHeight,f=e.offsetLeft,m=C-e.offsetLeft-y,b=e.offsetTop,O=v-e.offsetTop-p,H=r(e,"left"),S=r(e,"top");let x=+H,E=+S;H.includes("%")?(x=+document.body.clientWidth*(+H.replace(/%/g,"")/100),E=+document.body.clientHeight*(+S.replace(/%/g,"")/100)):(x=+H.replace(/px/g,""),E=+S.replace(/px/g,"")),document.onmousemove=function(A){let T=A.clientX-d,P=A.clientY-u;-T>f?T=-f:T>m&&(T=m),-P>b?P=-b:P>O&&(P=O),e.style.cssText+=`;left:${T+x}px;top:${P+E}px;`},document.onmouseup=()=>{document.onmousemove=null,document.onmouseup=null}})},c=()=>{const i=document.querySelectorAll(".ant-modal-wrap");for(const a of Array.from(i)){if(!a)continue;const e=r(a,"display"),t=a.getAttribute("data-drag");e!=="none"&&(t===null||n(o.destroyOnClose))&&l(a)}};Y(()=>{!n(o.open)||!n(o.draggable)||Ce(()=>{c()},30)})}function Ze(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!Re(o)}const Qe=W({name:"Modal",inheritAttrs:!1,props:ee,emits:["cancel"],setup(o,{slots:r,emit:l}){const{open:c,draggable:i,destroyOnClose:a}=De(o),e=Se();Ke({open:c,destroyOnClose:a,draggable:i});const t=d=>{l("cancel",d)};return()=>{let d;const u=L(k(k({},n(e)),o),{onCancel:t});return B(qe,u,Ze(d=He(r))?d:{default:()=>[d]})}}}),ge=Symbol();function et(o){return Be(o,ge)}function ft(){return ke(ge)}const tt=["loading-tip"],nt=W({name:"ModalWrapper",inheritAttrs:!1,__name:"ModalWrapper",props:{loading:{type:Boolean},useWrapper:{type:Boolean,default:!0},modalHeaderHeight:{type:Number,default:57},modalFooterHeight:{type:Number,default:74},minHeight:{type:Number,default:200},height:{type:Number},footerOffset:{type:Number,default:0},open:{type:Boolean},fullScreen:{type:Boolean},loadingTip:{type:String}},emits:["height-change","ext-height"],setup(o,{expose:r,emit:l}){const c=o,i=l,a=g(null),e=g(null),t=g(0),d=g(0),u=g(0);Ge(y.bind(null)),Fe(e,()=>{y()},{attributes:!0,subtree:!0}),et({redoModalHeight:y});const C=F(()=>({minHeight:`${c.minHeight}px`,height:`${n(t)}px`}));Y(()=>{c.useWrapper&&y()}),de(()=>c.fullScreen,p=>{y(),p?d.value=t.value:t.value=d.value}),_e(()=>{const{modalHeaderHeight:p,modalFooterHeight:f}=c;i("ext-height",p+f)}),pe(()=>{});function v(){return z(this,null,function*(){$(()=>{var f;const p=n(a);p&&((f=p==null?void 0:p.scrollTo)==null||f.call(p,0))})})}function y(){return z(this,null,function*(){if(!c.open)return;const p=n(a);if(!p)return;const f=p.$el.parentElement;if(f){f.style.padding="0",yield $();try{const m=f.parentElement&&f.parentElement.parentElement;if(!m)return;const b=getComputedStyle(m).top,O=Number.parseInt(b);let H=window.innerHeight-O*2+(c.footerOffset||0)-c.modalFooterHeight-c.modalHeaderHeight;O<40&&(H-=26),yield $();const S=n(e);if(!S)return;yield $(),u.value=S.scrollHeight,c.fullScreen?t.value=window.innerHeight-c.modalFooterHeight-c.modalHeaderHeight-28:t.value=c.height?c.height:u.value>H?H:u.value,i("height-change",n(t))}catch(m){}}})}return r({scrollTop:v,setModalHeight:y}),(p,f)=>{const m=We("loading");return M(),D(n(Oe),{ref_key:"wrapperRef",ref:a,scrollHeight:u.value},{default:h(()=>[xe((M(),X("div",{ref_key:"spinRef",ref:e,style:Ee(C.value),"loading-tip":o.loadingTip},[N(p.$slots,"default")],12,tt)),[[m,o.loading]])]),_:3},8,["scrollHeight"])}}}),ot=W({name:"ModalClose",__name:"ModalClose",props:{canFullscreen:{type:Boolean,default:!0},fullScreen:{type:Boolean}},emits:["cancel","fullscreen"],setup(o,{emit:r}){const l=o,c=r,{prefixCls:i}=ce("basic-modal-close"),{t:a}=ie(),e=F(()=>[i,`${i}--custom`,{[`${i}--can-full`]:l.canFullscreen}]);function t(u){c("cancel",u)}function d(u){u==null||u.stopPropagation(),u==null||u.preventDefault(),c("fullscreen")}return(u,C)=>(M(),X("div",{class:Le(e.value)},[o.canFullscreen?(M(),X(je,{key:0},[o.fullScreen?(M(),D(n(U),{key:0,title:n(a)("component.modal.restore"),placement:"bottom"},{default:h(()=>[B(n(Ve),{role:"full",onClick:d})]),_:1},8,["title"])):(M(),D(n(U),{key:1,title:n(a)("component.modal.maximize"),placement:"bottom"},{default:h(()=>[B(n(Xe),{role:"close",onClick:d})]),_:1},8,["title"]))],64)):G("",!0),B(n(U),{title:n(a)("component.modal.close"),placement:"bottom"},{default:h(()=>[B(n(Ye),{onClick:t})]),_:1},8,["title"])],2))}}),at=W({name:"BasicModalFooter",__name:"ModalFooter",props:ee,emits:["ok","cancel"],setup(o,{emit:r}){const l=r;function c(a){l("ok",a)}function i(a){l("cancel",a)}return(a,e)=>{const t=Ie("a-button");return M(),X("div",null,[N(a.$slots,"insertFooter"),a.showCancelBtn?(M(),D(t,I({key:0},a.cancelButtonProps,{onClick:i}),{default:h(()=>[J(K(a.cancelText),1)]),_:1},16)):G("",!0),N(a.$slots,"centerFooter"),a.showOkBtn?(M(),D(t,I({key:1,type:a.okType,onClick:c,loading:a.confirmLoading},a.okButtonProps),{default:h(()=>[J(K(a.okText),1)]),_:1},16,["type","loading"])):G("",!0),N(a.$slots,"appendFooter")])}}}),lt=W({name:"BasicModalHeader",__name:"ModalHeader",props:{helpMessage:{type:[String,Array]},title:{type:String}},setup(o){return(r,l)=>(M(),D(n(we),{helpMessage:o.helpMessage},{default:h(()=>[J(K(o.title),1)]),_:1},8,["helpMessage"]))}});function st(o){const r=g(!1),l=F(()=>{const i=n(o.wrapClassName)||"";return n(r)?`fullscreen-modal ${i} `:n(i)});function c(i){i&&i.stopPropagation(),r.value=!n(r)}return{getWrapClassName:l,handleFullScreen:c,fullScreenRef:r}}const rt=W({name:"BasicModal",inheritAttrs:!1,__name:"BasicModal",props:ee,emits:["open-change","height-change","cancel","ok","register","update:open"],setup(o,{emit:r}){const l=o,c=r,i=Ae(),a=g(!1),e=g(null),t=g(null),{prefixCls:d}=ce("basic-modal"),u=g(0),C={setModalProps:x,emitOpen:void 0,redoModalHeight:()=>{$(()=>{n(t)&&n(t).setModalHeight()})}},v=Q();v&&c("register",C,v.uid);const y=F(()=>k(k({},l),n(e))),{handleFullScreen:p,getWrapClassName:f,fullScreenRef:m}=st({modalWrapperRef:t,extHeightRef:u,wrapClassName:ze(y.value,"wrapClassName")}),b=F(()=>{const s=L(k({},n(y)),{open:n(a),okButtonProps:void 0,cancelButtonProps:void 0,title:void 0});return L(k({},s),{wrapClassName:n(f)})}),O=F(()=>{const s=L(k(k({},i),n(y)),{open:n(a)});return s.wrapClassName=`${(s==null?void 0:s.wrapClassName)||""} ${n(f)}vben-basic-modal-wrap`,n(m)?V(s,["height","title"]):V(s,"title")}),H=F(()=>{if(!n(m))return n(b).height});Y(()=>{a.value=!!l.open,m.value=!!l.defaultFullscreen}),de(()=>n(a),s=>{var R;c("open-change",s),c("update:open",s),v&&((R=C.emitOpen)==null||R.call(C,s,v.uid)),$(()=>{l.scrollTop&&s&&n(t)&&n(t).scrollTop()})},{immediate:!1});function S(s){return z(this,null,function*(){var R,w;if(s==null||s.stopPropagation(),!((w=(R=s.target)==null?void 0:R.classList)!=null&&w.contains(d+"-close--custom"))){if(l.closeFunc&&me(l.closeFunc)){const j=yield l.closeFunc();a.value=!j;return}a.value=!1,c("cancel",s)}})}function x(s){e.value=Te(n(e)||{},s),Reflect.has(s,"open")&&(a.value=!!s.open),Reflect.has(s,"defaultFullscreen")&&(m.value=!!s.defaultFullscreen)}function E(s){c("ok",s)}function A(s){c("height-change",s)}function T(s){u.value=s}function P(s){l.canFullscreen&&(s.stopPropagation(),p(s))}return(s,R)=>(M(),D(n(Qe),I(O.value,{onCancel:S}),oe({default:h(()=>[B(nt,I({useWrapper:b.value.useWrapper,footerOffset:s.wrapperFooterOffset,fullScreen:n(m),ref_key:"modalWrapperRef",ref:t,loading:b.value.loading,"loading-tip":b.value.loadingTip,minHeight:b.value.minHeight,height:H.value,open:a.value,modalFooterHeight:s.footer!==void 0&&!s.footer?0:void 0},n(V)(b.value.wrapperProps,"open","height","modalFooterHeight"),{onExtHeight:T,onHeightChange:A}),{default:h(()=>[N(s.$slots,"default")]),_:3},16,["useWrapper","footerOffset","fullScreen","loading","loading-tip","minHeight","height","open","modalFooterHeight"])]),_:2},[s.$slots.closeIcon?void 0:{name:"closeIcon",fn:h(()=>[B(ot,{canFullscreen:b.value.canFullscreen,fullScreen:n(m),onCancel:S,onFullscreen:n(p)},null,8,["canFullscreen","fullScreen","onFullscreen"])]),key:"0"},s.$slots.title?void 0:{name:"title",fn:h(()=>[B(lt,{helpMessage:b.value.helpMessage,title:y.value.title,onDblclick:P},null,8,["helpMessage","title"])]),key:"1"},s.$slots.footer?void 0:{name:"footer",fn:h(()=>[B(at,I(O.value,{onOk:E,onCancel:S}),oe({_:2},[ae(Object.keys(s.$slots),w=>({name:w,fn:h(j=>[N(s.$slots,w,le(se(j||{})))])}))]),1040)]),key:"2"},ae(Object.keys(n(V)(s.$slots,"default")),w=>({name:w,fn:h(j=>[N(s.$slots,w,le(se(j||{})))])}))]),1040))}}),_=fe({}),Z=fe({});function mt(){const o=g(null),r=g(!1),l=g(0);function c(e,t){if(!Q())throw new Error("useModal() can only be used inside setup() or functional components!");l.value=t,pe(()=>{o.value=null,r.value=!1,_[String(n(l))]=null}),!(n(r)&&Pe()&&e===n(o))&&(o.value=e,r.value=!0,e.emitOpen=(d,u)=>{Z[u]=d})}const i=()=>{const e=n(o);return e||ue("useModal instance is undefined!"),e},a={setModalProps:e=>{var t;(t=i())==null||t.setModalProps(e)},getOpen:F(()=>Z[~~n(l)]),redoModalHeight:()=>{var e,t;(t=(e=i())==null?void 0:e.redoModalHeight)==null||t.call(e)},openModal:(e=!0,t,d=!0)=>{var v;if((v=i())==null||v.setModalProps({open:e}),!t)return;const u=n(l);if(d){_[u]=null,_[u]=q(t);return}Ue(q(_[u]),q(t))||(_[u]=q(t))},closeModal:()=>{var e;(e=i())==null||e.setModalProps({open:!1})}};return[c,a]}const gt=o=>{const r=g(null),l=Q(),c=g(0),i=()=>{const e=n(r);return e||ue("useModalInner instance is undefined!"),e},a=(e,t)=>{$e(()=>{r.value=null}),c.value=t,r.value=e,l==null||l.emit("register",e,t)};return Y(()=>{const e=_[n(c)];e&&(!o||!me(o)||$(()=>{o(e)}))}),[a,{changeLoading:(e=!0)=>{var t;(t=i())==null||t.setModalProps({loading:e})},getOpen:F(()=>Z[~~n(c)]),changeOkLoading:(e=!0)=>{var t;(t=i())==null||t.setModalProps({confirmLoading:e})},closeModal:()=>{var e;(e=i())==null||e.setModalProps({open:!1})},setModalProps:e=>{var t;(t=i())==null||t.setModalProps(e)},redoModalHeight:()=>{var t;const e=(t=i())==null?void 0:t.redoModalHeight;e&&e()}}]},ht=Ne(rt);export{ht as B,gt as a,ft as b,mt as u};
